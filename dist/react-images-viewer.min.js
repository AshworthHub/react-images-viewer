!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("prop-types"),require("react"),require("aphrodite/no-important"),require("react-transition-group"),require("react-dom"),require("aphrodite"),require("react-scrolllock")):"function"==typeof define&&define.amd?define(["prop-types","react","aphrodite/no-important","react-transition-group","react-dom","aphrodite","react-scrolllock"],t):e.ImgsViewer=t(e.PropTypes,e.React,e.aphrodite,e.ReactTransitionGroup,e.ReactDOM,e.aphrodite,e.ScrollLock)}(this,function(e,t,r,n,o,i,a){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var s="default"in t?t.default:t;a=a&&a.hasOwnProperty("default")?a.default:a;var l={container:{background:"rgba(0, 0, 0, .8)",gutter:{horizontal:10,vertical:10},zIndex:2001},header:{height:40},close:{fill:"white"},footer:{color:"#fff",count:{color:"rgba(255, 255, 255, .75)",fontSize:".85em"},height:40,gutter:{horizontal:0,vertical:5}},thumbnail:{activeBorderColor:"#fff",size:50,outter:2},arrow:{background:"none",fill:"#fff",height:120}},c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},p=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},d=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},m=function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r},f=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t};function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Object.assign({},e);return Object.keys(t).forEach(function(n){"object"===c(t[n])&&t[n]&&e[n]?r[n]=g(e[n],t[n]):r[n]=t[n]}),r}var v=!("undefined"==typeof window||!window.document||!window.document.createElement);var y={arrowLeft:function(e){},arrowRight:function(e){return'<svg fill="'+e+'" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100%" height="100%" viewBox="0 0 512 512" xml:space="preserve">\n\t\t<path d="M298.3,256L298.3,256L298.3,256L131.1,81.9c-4.2-4.3-4.1-11.4,0.2-15.8l29.9-30.6c4.3-4.4,11.3-4.5,15.5-0.2l204.2,212.7 c2.2,2.2,3.2,5.2,3,8.1c0.1,3-0.9,5.9-3,8.1L176.7,476.8c-4.2,4.3-11.2,4.2-15.5-0.2L131.3,446c-4.3-4.4-4.4-11.5-0.2-15.8 L298.3,256z"/>\n\t</svg>'},close:function(e){return'<svg fill="'+e+'" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="100%" height="100%" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">\n\t\t<path d="M443.6,387.1L312.4,255.4l131.5-130c5.4-5.4,5.4-14.2,0-19.6l-37.4-37.6c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4 L256,197.8L124.9,68.3c-2.6-2.6-6.1-4-9.8-4c-3.7,0-7.2,1.5-9.8,4L68,105.9c-5.4,5.4-5.4,14.2,0,19.6l131.5,130L68.4,387.1 c-2.6,2.6-4.1,6.1-4.1,9.8c0,3.7,1.4,7.2,4.1,9.8l37.4,37.6c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1L256,313.1l130.7,131.1 c2.7,2.7,6.2,4.1,9.8,4.1c3.5,0,7.1-1.3,9.8-4.1l37.4-37.6c2.6-2.6,4.1-6.1,4.1-9.8C447.7,393.2,446.2,389.7,443.6,387.1z"/>\n\t</svg>'}},b=function(e){var t=e.fill,r=e.type,n=m(e,["fill","type"]),o=y[r];return s.createElement("span",h({dangerouslySetInnerHTML:{__html:o(t)}},n))};function w(e,t){var n=t.theme,o=e.direction,i=e.icon,a=e.onClick,c=e.size,u=m(e,["direction","icon","onClick","size"]),p=r.StyleSheet.create(g(k,n));return s.createElement("button",h({type:"button",className:r.css(p.arrow,p["arrow__direaction__"+o],c&&p["arrow__size__"+c]),onClick:a,onTouchEnd:a},u),s.createElement(b,{fill:!!n.arrow&&n.arrow.fill||l.arrow.fill,type:i}))}b.defaultProps={fill:"#fff"},w.defaultProps={size:"medium"},w.contextTypes={theme:e.object.isRequired};var k={arrow:{background:"none",border:"none",borderRadius:4,cursor:"pointer",outline:"none",padding:10,position:"absolute",top:"50%",WebkitTouchCallout:"none",userSelect:"none"},arrow__size__medium:{height:l.arrow.height,marginTop:l.arrow.height/-2,width:40,"@media (min-width: 768px)":{width:70}},arrow__size__small:{height:l.thumbnail.size,marginTop:l.thumbnail.size/-2,width:30,"@media (min-width: 500px)":{width:40}},arrow__size__right:{right:l.container.gutter.horizontal},arrow__size__left:{left:l.container.gutter.horizontal}};function C(e,t){var n=t.theme,o=m(e,[]),i=r.StyleSheet.create(g(x,n));return s.createElement("div",h({id:"viewerBackdrop",className:r.css(i.container)},o))}C.contextTypes={theme:e.object.isRequired};var x={container:{alighItems:"center",backdropColor:l.container.background,boxSizing:"border-box",display:"flex",height:"100%",justifyContent:"center",left:0,paddingTop:l.container.gutter.vertical,paddingRight:l.container.gutter.horizontal,paddingBottom:l.container.gutter.vertical,paddingLeft:l.container.gutter.horizontal,position:"fixed",top:0,width:"100%",zIndex:l.container.zIndex}};function E(e,t){var n=t.theme,o=e.caption,i=e.countCurr,a=e.countSeparator,l=e.countTotal,c=e.showCount,u=m(e,["caption","countCurr","countSeparator","countTotal","showCount"]);if(!o&&!c)return null;var p=r.StyleSheet.create(g(S,n)),d=c?s.createElement("div",{className:r.css(p.footerCount)},i,a,l):s.createElement("span",null);return s.createElement("div",h({className:r.css(p.footer)},u),o?s.createElement("figcaption",{className:r.css(p.footerCaptioin)},o):s.createElement("span",null),d)}E.contextTypes={theme:e.object.isRequired};var S={foooter:{boxSizing:"border-box",color:l.footer.color,cursor:"auto",display:"flex",justifyContent:"space-between",left:0,lineHeight:1.3,paddingTop:l.footer.gutter.vertical,paddingRight:l.footer.gutter.horizontal,paddingBottom:l.footer.gutter.vertical,paddingLeft:l.footer.gutter.horizontal},footerCount:{color:l.footer.count.color,fontSize:l.footer.count.fontSize,paddingLeft:"1em"},footerCaption:{flex:"1 1 0"}};function I(e,t){var n=t.theme,o=e.customControls,i=e.onClose,a=e.showCloseBtn,c=e.closeBtnTitle,u=m(e,["customControls","onClose","showCloseBtn","closeBtnTitle"]),p=r.StyleSheet.create(g(_,n));return s.createElement("div",h({className:r.css(p.header)},u),o||s.createElement("span",null),!!a&&s.createElement("button",{title:c,className:r.css(p.close),onClick:i},s.createElement(b,{fill:!!n.close&&n.close.fill||l.close.fill,type:"close"})))}I.contextTypes={theme:e.object.isRequired};var _={header:{display:"flex",justifyContent:"space-between",height:l.header.height},close:{background:"none",border:"none",cursor:"pointer",outline:"none",position:"relative",top:0,verticalAlign:"bottom",height:40,marginRight:-10,padding:10,width:40}};function T(e,t){var n=e.index,o=e.src,i=e.thumbnail,a=e.active,l=e.onClick,c=t.theme,u=i||o,p=r.StyleSheet.create(g(z,c));return s.createElement("div",{className:r.css(p.thumnail,a&&p.thumbnail__active),onClick:function(e){e.preventDefault(),e.stopPropagation(),l(n)},style:{backgroundImage:'url("'+u+'")'}})}T.contextTypes={theme:e.object.isRequired};var z={thumbnail:{backgroundPosition:"center",backgroundSize:"cover",borderRadius:2,boxShadow:"inset 0 0 0 1px hsla(0, 0%, 100%, .2)",cursor:"pointer",display:"inline-block",height:l.thumbnail.size,margin:l.thumbnail.gutter,overflow:"hidden",width:l.thumbnail.size},thumbnail__active:{boxShadow:"inset 0 0 0 2px "+l.thumbnail.activeBorderColor}},L=r.StyleSheet.create({paginatedThumbnails:{bottom:l.container.gutter.vertical,height:l.thumbnail.size,padding:"0 50px",position:"absolute",textAlign:"center",whiteSpace:"nowrap",left:"50%",transform:"translateX(-50%)"}}),P={height:l.thumbnail.size+2*l.thumbnail.gutter,width:40},N=function(e){function t(e){u(this,t);var r=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.state={hasCustomPage:!1},r.gotoPrev=r.gotoPrev.bind(r),r.gotoNext=r.gotoNext.bind(r),r}return d(t,e),p(t,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.currImg!==this.props.currImg&&this.setState({hasCustomPage:!1})}},{key:"getFirst",value:function(){var e=this.props,t=e.currImg,r=e.offset;return this.state.hasCustomPage?this.clampFirst(this.state.first):this.clampFirst(t-r)}},{key:"setFirst",value:function(e,t){var r=this.state.first;e&&(e.preventDefault(),e.stopPropagation()),r!==t&&this.setState({hasCustomPage:!0,first:t})}},{key:"gotoPrev",value:function(e){this.setFirst(e,this.getFirst()-this.props.offset)}},{key:"gotoNext",value:function(e){this.setFirst(e,this.getFirst()+this.props.offset)}},{key:"clampFirst",value:function(e){var t=this.props,r=t.imgs,n=2*t.offset+1;return e<0?0:e+n>r.length?r.length-n:e}},{key:"renderArrowPrev",value:function(){return this.getFirst()<=0?null:s.createElement(w,{direction:"left",size:"small",icon:"arrowLeft",onClick:this.gotoPrev,style:P,title:"下一张",type:"button"})}},{key:"render",value:function(){var e=this.props,t=e.imgs,n=e.currImg,o=e.onClickThumbnail,i=2*e.offset+1,a=[],l=0;return t.length<=i?a=t:(l=this.getFirst(),a=t.slice(l,l+i)),s.createElement("div",{className:r.css(L.paginatedThumbnails)},this.renderArrowPrev(),a.map(function(e,t){return s.createElement(T,h({key:l+t},e,{index:l+t,onclick:o,active:l+t===n}))}),this.renderArrowNext())}}]),t}(t.Component),O=function(e){function r(){return u(this,r),f(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return d(r,e),p(r,[{key:"getChildContext",value:function(){return this.props.context}},{key:"render",value:function(){return t.Children.only(this.props.children)}}]),r}(t.Component);O.childContextTypes={theme:e.object};var j=function(e){function t(){u(this,t);var e=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.portalElement=null,e}return d(t,e),p(t,[{key:"componentDidMount",value:function(){var e=document.createElement("div");document.body.appendChild(e),this.portalElement=e,this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){o.render(s.createElement(O,{context:this.context},s.createElement("div",null,s.createElement("style",null,"\n      .fade-eneter { opacity: .01; }\n      .fade-enter.fade-enter-active { opacity: 1; transition: opacity 200ms; }\n      .fade-leave { opacity: 1; }\n      .fade-leave.fade-leave-active { opacity: .01; transition: opacity 200ms; }\n    "),s.createElement(n.CSSTransitionGroup,h({component:"div",transitionName:"fade",transitionEnterTimeout:200,transitionLeaveTimeout:200},this.props)))),this.portalElement)}},{key:"UNSAFE_componentWillUnmount",value:function(){o.unmountComponentAtNode(this.portalElement),document.body.removeChild(this.portalElement)}},{key:"render",value:function(){return null}}]),t}(t.Component);j.contextTypes={theme:e.object.isRequired};var B={"0%":{top:"50%",left:"50%",width:0,height:0,opacity:1},"100%":{top:0,left:0,width:"100%",height:"100%",opacity:0}},A=function(e){var t=e.color,r=e.size;return{spinner:{display:"inline-block",position:"relative",width:r,height:r},ripple:{position:"absolute",border:"4px solid "+t,opacity:1,borderRadius:"50%",animationName:B,animationDuration:"1s",animationTimingFunctions:"cubic-bezier(0, .2, .8, 1)",animationIterationCount:"infinite"}}};function R(e){var t=e.srcSet||e.srcset;return Array.isArray(t)?t.join():t}var F=function(e){function r(e){u(this,r);var t=f(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.theme=g(l,t.theme),t.classes=i.StyleSheet.create(g(q,t.theme)),t.state={imgLoaded:!1},function(e){var t=this;e.forEach(function(e){return t[e]=t[e].bind(t)})}.call(t,["gotoNext","gotoPrev","closeBackdrop","handleKeyboardInput","handleImgLoaded"]),t}return d(r,e),p(r,[{key:"getChildContext",value:function(){return{theme:this.theme}}},{key:"componentDidMount",value:function(){this.props.isOpen&&(this.props.enableKeyboardInput&&window.addEventListener("keyboard",this.handleKeyboardInput),"number"==typeof this.props.currImg&&this.preloadImg(this.props.currImg,this.handleImgLoaded))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){if(v){if(e.preloadNextImg){var t=e.currImg+1,r=e.currImg-1;this.preloadImg(r),this.preloadImg(t)}if(this.props.currImg!==e.currImg||!this.props.isOpen&&e.isOpen){var n=this.preloadImg(e.currImg,this.handleImgLoaded);this.setState({imgLoaded:n.complete})}!this.props.isOpen&&e.isOpen&&e.enableKeyboardInput&&window.addEventListener("keyboard",this.handleKeyboardInput),!e.isOpen&&e.enableKeyboardInput&&window.removeEventListener("keydown",this.handleKeyboardInput)}}},{key:"UNSAFE_componentWillUnmount",value:function(){this.props.enableKeyboardInput&&window.removeEventListener("keydown",this.handleKeyboardInput)}},{key:"preloadImg",value:function(e,t){var r=this.props.imgs[e];if(r){var n=new Image,o=R(r);return n.onerror=t,n.onload=t,n.src=r.src,o&&(n.srcset=o),n}}},{key:"gotoNext",value:function(e){var t=this.props,r=t.currImg,n=t.imgs;this.state.imgLoaded&&r!==n.length-1&&(e&&(e.preventDefault(),e.stopPropagation()),this.props.onClickNext())}},{key:"gotoPrev",value:function(e){var t=this.props.currImg;this.state.imgLoaded&&0!==t&&(e&&(e.preventDefault(),e.stopPropagation()),this.props.onClickPrev())}},{key:"closeBackdrop",value:function(e){"viewerBackdrop"!==e.target.id&&"FIGURE"!==e.target.tagName||this.props.onClose()}},{key:"handleKeyboardInput",value:function(e){var t=e.keyCode;return 37===t||33===t?(this.gotoPrev(e),!0):39===t||34===t?(this.gotoNext(e),!0):(27===t||32===t)&&(this.props.onClose(),!0)}},{key:"handleImgLoaded",value:function(){this.setState({imgLoaded:!0})}},{key:"renderArrowPrev",value:function(){return 0===this.props.currImg?null:s.createElement(w,{direction:"left",icon:"arrowLeft",onClick:this.gotoPrev,title:this.props.leftArrowTitle,type:"button"})}},{key:"renderArrowNext",value:function(){return this.props.currImg===this.props.imgs.length-1?null:s.createElement(w,{direction:"right",icon:"arrowRight",onClick:this.gotoNext,title:this.props.rightArrowTitle,type:"button"})}},{key:"renderDialog",value:function(){var e=this.props,r=e.backdropCloseable,n=e.isOpen,o=e.showThumbnails,l=e.width,c=this.state.imgLoaded;if(!n)return s.createElement("span",{key:"closed"});var u=o?this.theme.thumnail.size+this.theme.container.gutter.vertical:0;return s.createElement(C,{key:"open",onClick:r&&this.closeBackdrop,onTouchEnd:r&&this.closeBackdrop},s.createElement(t.Fragment,null,s.createElement("div",{className:i.css(this.classes.content),style:{marginBottom:u,maxWidth:l}},c&&this.renderHeader(),this.renderImgs(),this.renderSpinner(),c&&this.renderFooter()),c&&this.renderThumbnails(),c&&this.renderArrowPrev(),c&&this.renderArrowNext(),this.props.preventScroll&&s.createElement(a,null)))}},{key:"renderImgs",value:function(){var e=this.props,t=e.currImg,r=e.imgs,n=e.onClickImg,o=e.showThumbnails,a=this.state.imgLoaded;if(!r||!r.length)return null;var l=r[t],c=R(l),u=c?"100vw":null,p=o?this.theme.thumnail.size:0,h=this.theme.header.height+this.theme.footer.height+p+this.theme.container.gutter.vertical+"px";return s.createElement("figure",{className:i.css(this.classes.figure)},s.createElement("img",{className:i.css(this.classes.img,a&&this.classes.imgLoaded),onClick:n,sizes:u,alt:l.alt,src:l.src,srcSet:c,style:{cursor:n?"pointer":"auto",maxHeight:"calc(100vh - "+h}}))}},{key:"renderThumbnails",value:function(){var e=this.props,t=e.imgs,r=e.currImg,n=e.onClickThumbnail,o=e.showThumbnails,i=e.thumbnailOffset;return o?s.createElement(N,{currImg:r,imgs:t,offset:i,onClickThumnail:n}):null}},{key:"renderHeader",value:function(){var e=this.props,t=e.closeBtnTitle,r=e.customControls,n=e.onClose,o=e.showCloseBtn;return s.createElement(I,{customControls:r,onClose:n,showCloseBtn:o,closeBtnTitle:t})}},{key:"renderFooter",value:function(){var e=this.props,t=e.currImg,r=e.imgs,n=e.imgCountSeparator,o=e.showImgCount;return r&&r.length?s.createElement(E,{caption:r[t].caption,countCurr:t+1,countSeparator:n,countTotal:r.length,showCount:o}):null}},{key:"renderSpinner",value:function(){var e=this.props,t=e.spinner,r=e.spinnerColor,n=e.spinnerSize,o=this.state.imgLoaded,a=t;return s.createElement("div",{className:i.css(this.classes.spinner,!o&&this.classes.spinnerActive)},s.createElement(a,{color:r,size:n}))}},{key:"render",value:function(){return s.createElement(j,null,this.renderDialog())}}]),r}(t.Component);F.defaultProps={lang:"zh_CN",closeBtnTitle:"关闭（空格键）",currImg:0,enableKeyboardInput:!0,imgCountSeparator:" / ",leftArrowTitle:"上一张（向左键）",onClickShowNextImg:!0,preloadNextImg:!0,preventScroll:!0,rightArrowTitle:"下一张（向右键）",showCloseBtn:!0,showImgCount:!0,spinner:function(e){var t=r.StyleSheet.create(A(e));return s.createElement("div",{className:r.css(t.spinner)},s.createElement("div",{className:r.css(t.ripple)}))},spinnerColor:"#fff",spinnerSize:100,theme:{},thumbnailOffset:2,width:1024},F.childContextTypes={theme:e.object.isRequired};var q={content:{position:"relative"},figure:{margin:0},img:{display:"block",height:"auto",margin:"0 auto",maxWidth:"100%",WebkitTouchCallout:"none",userSelect:"none",opacity:0,transition:"opacity .3s"},imgLoaded:{opcaty:1},spinner:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",opacity:0,transition:"opacity .3s"},spinnerActive:{opacity:1}};return F});
